<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Faraday-Firmware: UART/UART_L2.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Faraday-Firmware
   &#160;<span id="projectnumber">1</span>
   </div>
   <div id="projectbrief">Firmware for the Faraday digital amateur radio</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_u_a_r_t___l2_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">UART/UART_L2.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Faraday UART Network Stack - Layer 2 Protocol.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;cc430f6137.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="_u_a_r_t___l2_8h_source.html">UART_L2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_r_e_v_a___faraday_8h_source.html">../REVA_Faraday.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_faraday___h_a_l_8h_source.html">../Faraday_HAL/Faraday_HAL.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_u_a_r_t___l4_8h_source.html">UART_L4.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_u_a_r_t___services_8h_source.html">UART_Services.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_f_i_f_o_8h_source.html">../Ring_Buffers/FIFO.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#ac7b3df0fa68526d64c732d5f916e34b1">init_uart</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize UART Layer 2 TX/RX State Machines.  <a href="#ac7b3df0fa68526d64c732d5f916e34b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a63c4d64ae4f2bd7e735cd4f4004263c5">uart_datalink_create_packet</a> (volatile <a class="el" href="_u_a_r_t___l2_8h.html#adcf7a574c5d9de1ceb93d5b1a97ee547">UART_DATALINK_PACKET_STRUCT</a> *buffer_struct, unsigned char packet_type, unsigned char packet_config, unsigned char payload_length, unsigned char *payload)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create UART Layer 2 Packet.  <a href="#a63c4d64ae4f2bd7e735cd4f4004263c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#abc559fd267d9d8c575be67bd3e265351">uart_datalink_put_tx</a> (unsigned char packet_type, unsigned char packet_config, unsigned char payload_length, unsigned char *payload)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create and transmit UART layer 2 packet.  <a href="#abc559fd267d9d8c575be67bd3e265351"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a7f4ea313a52dd3e9b9f680429024e54a">uart_datalink_get_tx</a> (unsigned char *get_buffer_ptr)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a UART layer 2 packet from receive buffer.  <a href="#a7f4ea313a52dd3e9b9f680429024e54a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a67bc69c3ef2e11e0372662a5ede276e2">uart_datalink_isempty_tx</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if UART Layer 2 transmit buffer is empty.  <a href="#a67bc69c3ef2e11e0372662a5ede276e2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a13c914a747e1af18c9b68577d3c676c1">uart_datalink_tx_housekeep</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">UART layer 2 transmit housekeeping.  <a href="#a13c914a747e1af18c9b68577d3c676c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#abfced9c8c49fca45b437c389b356b498">uart_datalink_rx_housekeep</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">UART layer 2 receive housekeeping.  <a href="#abfced9c8c49fca45b437c389b356b498"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a4840060f1b1b517dd7ca2dfd9fdb2446">uart_tx_datalink_isr</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">UART layer 2 transmit interrupt service routine.  <a href="#a4840060f1b1b517dd7ca2dfd9fdb2446"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#ad87829b6d6ba48eb341034a0ba17c5f1">uart_datalink_byte_isempty_rx</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if UART Layer 2 receive buffer is empty.  <a href="#ad87829b6d6ba48eb341034a0ba17c5f1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a642642befe890ebd6eff7d8ccb003a4f">uart_datalink_rx_put_byte</a> (volatile unsigned char *data_byte)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Place a byte into the receive buffer for uart layer 2.  <a href="#a642642befe890ebd6eff7d8ccb003a4f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a6a35d37b82cc1e3975df2f13a3779904">uart_datalink_rx_frame_parser_check_state</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">*  <a href="#a6a35d37b82cc1e3975df2f13a3779904"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a0c5d79acaccffa349f366585a9b944a5">uart_datalink_rx_frame_parser_change_state</a> (unsigned char state)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#a0c5d79acaccffa349f366585a9b944a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a0dd8b8c8ac31926f0d3a3bc05fec28a6">uart_datalink_rx_frame_parser_state_idle</a> (unsigned char new_byte)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#a0dd8b8c8ac31926f0d3a3bc05fec28a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#ab9d26f59f7a919d9e2c8ebcf71a34d0c">uart_datalink_rx_frame_parser_state_start</a> (unsigned char new_byte)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#ab9d26f59f7a919d9e2c8ebcf71a34d0c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#ac032a2e63152c8832e5c1884881076e6">uart_datalink_rx_frame_parser_state_stop</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#ac032a2e63152c8832e5c1884881076e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a960448902e9fadb313a6f19103d9a35b">uart_datalink_rx_frame_parser_state_esc</a> (unsigned char new_byte)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#a960448902e9fadb313a6f19103d9a35b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#aad11fa669cfb8134e56b1aed868f4560">uart_datalink_rx_framer_parser_parse_byte</a> (unsigned char new_byte)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">************************************************************  <a href="#aad11fa669cfb8134e56b1aed868f4560"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_u_a_r_t___l2_8c.html#a80a393448695d1ec96dce4f9094a783a">uart_datalink_rx_pass_higher_layer</a> (unsigned char datagram_len, unsigned char *datagram)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">UART layer 2 receiver higher OSI layer interface.  <a href="#a80a393448695d1ec96dce4f9094a783a"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">UART Packet FIFO Buffer Variables</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>FIFO structure and byte array declarations</p>
<p>FIFO structure and byte array declarations that provide buffering for the fast incoming and outgoing UART data. These FIFO's are packet based and also use the internal RAM of the CC430 for maximum speed. </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7fdc378de86e697af6d56eb31386e89c"></a><!-- doxytag: member="UART_L2.c::uart_tx_bytes_state_machine" ref="a7fdc378de86e697af6d56eb31386e89c" args="" -->
volatile <a class="el" href="struct_f_i_f_o___buffer___state___machine.html">fifo_state_machine</a>&#160;</td><td class="memItemRight" valign="bottom"><b>uart_tx_bytes_state_machine</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80ea969cd013f06134ea63f313eea350"></a><!-- doxytag: member="UART_L2.c::uart_data_tx_bytes_256" ref="a80ea969cd013f06134ea63f313eea350" args="[UART_TX_BUFFER_SIZE]" -->
volatile unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>uart_data_tx_bytes_256</b> [UART_TX_BUFFER_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a46e24cd10cce34b7779c5f3b2f242ddc"></a><!-- doxytag: member="UART_L2.c::uart_rx_raw_bytes_state_machine" ref="a46e24cd10cce34b7779c5f3b2f242ddc" args="" -->
volatile <a class="el" href="struct_f_i_f_o___buffer___state___machine.html">fifo_state_machine</a>&#160;</td><td class="memItemRight" valign="bottom"><b>uart_rx_raw_bytes_state_machine</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5f979812dea613dee0173576c35962f0"></a><!-- doxytag: member="UART_L2.c::uart_data_rx_raw_bytes" ref="a5f979812dea613dee0173576c35962f0" args="[64]" -->
volatile unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>uart_data_rx_raw_bytes</b> [64]</td></tr>
<tr><td colspan="2"><div class="groupHeader">UART Layer 2 Transmit Framing Structure</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>UART layer 2 transmit framing structure declaration</p>
<p>UART layer 2 transmit framing structure declaration that is used to control the detection, byte escaping, and parsing of the layer 2 protocol frame. </p>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac9afd4d4c944f4460af29b7cea9b6dba"></a><!-- doxytag: member="UART_L2.c::uart_tx_bytes_isr_buffer_struct" ref="ac9afd4d4c944f4460af29b7cea9b6dba" args="" -->
volatile <br class="typebreak"/>
<a class="el" href="_u_a_r_t___l2_8h.html#ac53614c0c475db20de3fff04fb01b3c5">UART_DATALINK_PACKET_MSP430_BUFFER_STRUCT</a>&#160;</td><td class="memItemRight" valign="bottom"><b>uart_tx_bytes_isr_buffer_struct</b></td></tr>
<tr><td colspan="2"><div class="groupHeader">Receive Frame State Machine Variables</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>Receive frame state machine variable declarations</p>
<p>UART layer 2 receive frame state machine variable declarations that control the parsing of layer 2 frames.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000031">Todo:</a></b></dt><dd>This should become a structure for clarity</dd></dl>
</div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac1247c865c4e1f79a6871e98a46939c5"></a><!-- doxytag: member="UART_L2.c::uart_datalink_frame_rx_state" ref="ac1247c865c4e1f79a6871e98a46939c5" args="" -->
volatile unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>uart_datalink_frame_rx_state</b> = <a class="el" href="_u_a_r_t___l2_8h.html#aee5e9357cbd40f30ab04e9d7ab627142">UART_DATALINK_RX_STATE_IDLE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae70ea4a0b884949048c814256ab1ddc6"></a><!-- doxytag: member="UART_L2.c::rx_datalink_packet" ref="ae70ea4a0b884949048c814256ab1ddc6" args="[128]" -->
volatile unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>rx_datalink_packet</b> [128]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad2f3cc5120db6fb46b5eb0d7ce7402d4"></a><!-- doxytag: member="UART_L2.c::rx_datalink_byte_cnt" ref="ad2f3cc5120db6fb46b5eb0d7ce7402d4" args="" -->
volatile unsigned char&#160;</td><td class="memItemRight" valign="bottom"><b>rx_datalink_byte_cnt</b></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Faraday UART Network Stack - Layer 2 Protocol. </p>
<p>This source file provides the layer 2 (datalink) layer protocol of the Faraday UART network stack. This layer provides byte framing between the CC430 hardware UART and defines a layer 2 protocol. </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac7b3df0fa68526d64c732d5f916e34b1"></a><!-- doxytag: member="UART_L2.c::init_uart" ref="ac7b3df0fa68526d64c732d5f916e34b1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#ac7b3df0fa68526d64c732d5f916e34b1">init_uart</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize UART Layer 2 TX/RX State Machines. </p>
<p>This function initializes the Layer 2 UART transmit and receive state machines. Initialize values such as packet lengths and buffer sizes are initialized into the statemachines for proper operation. </p>

</div>
</div>
<a class="anchor" id="ad87829b6d6ba48eb341034a0ba17c5f1"></a><!-- doxytag: member="UART_L2.c::uart_datalink_byte_isempty_rx" ref="ad87829b6d6ba48eb341034a0ba17c5f1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="_u_a_r_t___l2_8h.html#ad87829b6d6ba48eb341034a0ba17c5f1">uart_datalink_byte_isempty_rx</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if UART Layer 2 receive buffer is empty. </p>
<p>This function is used to check if the receive buffer is empty or contains at least 1 packet waiting for retrieval. This is a very useful function to create higher level "checks" to determine if there is waiting data to be retrieved without actually "popping" the data out of the FIFO.</p>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">Returns</td><td>1 if buffer is empty. Returns 0 if buffer NOT empty. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a63c4d64ae4f2bd7e735cd4f4004263c5"></a><!-- doxytag: member="UART_L2.c::uart_datalink_create_packet" ref="a63c4d64ae4f2bd7e735cd4f4004263c5" args="(volatile UART_DATALINK_PACKET_STRUCT *buffer_struct, unsigned char packet_type, unsigned char packet_config, unsigned char payload_length, unsigned char *payload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a63c4d64ae4f2bd7e735cd4f4004263c5">uart_datalink_create_packet</a> </td>
          <td>(</td>
          <td class="paramtype">volatile <a class="el" href="_u_a_r_t___l2_8h.html#adcf7a574c5d9de1ceb93d5b1a97ee547">UART_DATALINK_PACKET_STRUCT</a> *&#160;</td>
          <td class="paramname"><em>buffer_struct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>packet_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>packet_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>payload_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create UART Layer 2 Packet. </p>
<p>This function creates a Layer 2 UART Packet for transmission. The function accepts several parameters that define the packet type, configuration bits, and other information.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">buffer_struct</td><td>Pointer to a UART_DATALINK_PACKET_STRUCT structure that will be filled with the supplied parameters/data </td></tr>
    <tr><td class="paramname">packet_type</td><td>A byte that describes the packet type which indicates how to parse the packet when received </td></tr>
    <tr><td class="paramname">packet_config</td><td>Configuration bytes to support link communication and flag sharing. Not yet implemented </td></tr>
    <tr><td class="paramname">payload_length</td><td>Length of the payload data in bytes </td></tr>
    <tr><td class="paramname">payload</td><td>A pointer to the byte/array of data to be packed into the packet </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a7f4ea313a52dd3e9b9f680429024e54a"></a><!-- doxytag: member="UART_L2.c::uart_datalink_get_tx" ref="a7f4ea313a52dd3e9b9f680429024e54a" args="(unsigned char *get_buffer_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="_u_a_r_t___l2_8h.html#a7f4ea313a52dd3e9b9f680429024e54a">uart_datalink_get_tx</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>get_buffer_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get a UART layer 2 packet from receive buffer. </p>
<p>This function is used to retrieve a waiting UART layer 2 byte in the UART receive buffer if present.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">get_buffer_ptr</td><td>Pointer to an array that will be filled with the received byte if present in the receive buffer</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">status</td><td>The function returns the status of the receive buffer Get() routine. If (status == 1) then retrieval of a byte was successful. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a67bc69c3ef2e11e0372662a5ede276e2"></a><!-- doxytag: member="UART_L2.c::uart_datalink_isempty_tx" ref="a67bc69c3ef2e11e0372662a5ede276e2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="_u_a_r_t___l2_8h.html#a67bc69c3ef2e11e0372662a5ede276e2">uart_datalink_isempty_tx</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if UART Layer 2 transmit buffer is empty. </p>
<p>This function is used to check if the transmit buffer is empty or contains at least 1 byte waiting for retrieval. This is a very useful function to create higher level "checks" to determine if there is waiting data to be retrieved without actually "popping" the data out of the FIFO.</p>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">Returns</td><td>1 if buffer is empty. Returns 0 if buffer NOT empty. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="abc559fd267d9d8c575be67bd3e265351"></a><!-- doxytag: member="UART_L2.c::uart_datalink_put_tx" ref="abc559fd267d9d8c575be67bd3e265351" args="(unsigned char packet_type, unsigned char packet_config, unsigned char payload_length, unsigned char *payload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="_u_a_r_t___l2_8h.html#abc559fd267d9d8c575be67bd3e265351">uart_datalink_put_tx</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>packet_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>packet_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>payload_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>payload</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create and transmit UART layer 2 packet. </p>
<p>This function implements several other function to both create a UART layer 2 packet from the supplied parameters and will then place the packet into the transmit FIFO for UART transmission.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">packet_type</td><td>A byte that describes the packet type which indicates how to parse the packet when received </td></tr>
    <tr><td class="paramname">packet_config</td><td>Configuration bytes to support link communication and flag sharing. Not yet implemented </td></tr>
    <tr><td class="paramname">payload_length</td><td>Length of the payload data in bytes </td></tr>
    <tr><td class="paramname">payload</td><td>A pointer to the byte/array of data to be packed into the packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt><b>Return values:</b></dt><dd>
  <table class="retval">
    <tr><td class="paramname">status</td><td>The function returns the status of the FIFO Put() operations. If (status == 1) then placing packet into FIFO was successfull </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0c5d79acaccffa349f366585a9b944a5"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_change_state" ref="a0c5d79acaccffa349f366585a9b944a5" args="(unsigned char state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a0c5d79acaccffa349f366585a9b944a5">uart_datalink_rx_frame_parser_change_state</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>Change the current state of the receive byte frame parser state machine. </p>

</div>
</div>
<a class="anchor" id="a6a35d37b82cc1e3975df2f13a3779904"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_check_state" ref="a6a35d37b82cc1e3975df2f13a3779904" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="_u_a_r_t___l2_8h.html#a6a35d37b82cc1e3975df2f13a3779904">uart_datalink_rx_frame_parser_check_state</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>* </p>
<p>Check the current UART receiver byte frame parser state machine state.</p>
<p>************************************************************ </p>

</div>
</div>
<a class="anchor" id="a960448902e9fadb313a6f19103d9a35b"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_state_esc" ref="a960448902e9fadb313a6f19103d9a35b" args="(unsigned char new_byte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a960448902e9fadb313a6f19103d9a35b">uart_datalink_rx_frame_parser_state_esc</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>new_byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>UART layer 2 receiver frame parser ESCAPE state routine. </p>

</div>
</div>
<a class="anchor" id="a0dd8b8c8ac31926f0d3a3bc05fec28a6"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_state_idle" ref="a0dd8b8c8ac31926f0d3a3bc05fec28a6" args="(unsigned char new_byte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a0dd8b8c8ac31926f0d3a3bc05fec28a6">uart_datalink_rx_frame_parser_state_idle</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>new_byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>UART layer 2 receiver frame parser IDLE state routine. </p>

</div>
</div>
<a class="anchor" id="ab9d26f59f7a919d9e2c8ebcf71a34d0c"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_state_start" ref="ab9d26f59f7a919d9e2c8ebcf71a34d0c" args="(unsigned char new_byte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#ab9d26f59f7a919d9e2c8ebcf71a34d0c">uart_datalink_rx_frame_parser_state_start</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>new_byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>UART layer 2 receiver frame parser START state routine. </p>

</div>
</div>
<a class="anchor" id="ac032a2e63152c8832e5c1884881076e6"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_frame_parser_state_stop" ref="ac032a2e63152c8832e5c1884881076e6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#ac032a2e63152c8832e5c1884881076e6">uart_datalink_rx_frame_parser_state_stop</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>UART layer 2 receiver frame parser STOP state routine. </p>

</div>
</div>
<a class="anchor" id="aad11fa669cfb8134e56b1aed868f4560"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_framer_parser_parse_byte" ref="aad11fa669cfb8134e56b1aed868f4560" args="(unsigned char new_byte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#aad11fa669cfb8134e56b1aed868f4560">uart_datalink_rx_framer_parser_parse_byte</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>new_byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>************************************************************ </p>
<p>UART layer 2 receiver high level state machine parser. </p>

</div>
</div>
<a class="anchor" id="abfced9c8c49fca45b437c389b356b498"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_housekeep" ref="abfced9c8c49fca45b437c389b356b498" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#abfced9c8c49fca45b437c389b356b498">uart_datalink_rx_housekeep</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>UART layer 2 receive housekeeping. </p>
<p>UART layer 2 receive housekeeping routine that performs actions needed on a reoccuring basis to enable the layer 2 protocol functionality. Actions such a checking for new data waiting to be retrieve are performed.</p>
<p>The receive housekeeping actions retrieve a waiting UART packet from the buffer if available and then parses it. When the parsing routine is complete it moves the parsed packet to the network layer above.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>A while() loop is used to retrieve, parse, and move data to the next highest network layer continuously until the receive buffer is empty. </dd></dl>

</div>
</div>
<a class="anchor" id="a80a393448695d1ec96dce4f9094a783a"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_pass_higher_layer" ref="a80a393448695d1ec96dce4f9094a783a" args="(unsigned char datagram_len, unsigned char *datagram)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a80a393448695d1ec96dce4f9094a783a">uart_datalink_rx_pass_higher_layer</a> </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>datagram_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>datagram</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>UART layer 2 receiver higher OSI layer interface. </p>
<p>This function is used to pass the parsed UART layer 2 packet data payload into the next higher OSI layer in the network stack. This is the only location in the UART layer 2 protocol that must know about and interact with the next higher OSI layer services.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">datagram_len</td><td>The length of the supplied datagram (packet) in bytes </td></tr>
    <tr><td class="paramname">datagram</td><td>A pointer to the byte array containing the UART layer 2 data payload which is actually a higher layer packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000032">Todo:</a></b></dt><dd>Update this interface with a function pointer based interface that can be dynamically "registered" like the UART Layer 4 service ports. This will remove the need to include layer 4 header files and function calls.</dd></dl>

</div>
</div>
<a class="anchor" id="a642642befe890ebd6eff7d8ccb003a4f"></a><!-- doxytag: member="UART_L2.c::uart_datalink_rx_put_byte" ref="a642642befe890ebd6eff7d8ccb003a4f" args="(volatile unsigned char *data_byte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a642642befe890ebd6eff7d8ccb003a4f">uart_datalink_rx_put_byte</a> </td>
          <td>(</td>
          <td class="paramtype">volatile unsigned char *&#160;</td>
          <td class="paramname"><em>data_byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Place a byte into the receive buffer for uart layer 2. </p>
<p>This function allows you to place a received uart byte into the recieve buffer for further parsing.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">data_byte</td><td>A pointer to the byte that will be placed into the receive byte buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a13c914a747e1af18c9b68577d3c676c1"></a><!-- doxytag: member="UART_L2.c::uart_datalink_tx_housekeep" ref="a13c914a747e1af18c9b68577d3c676c1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a13c914a747e1af18c9b68577d3c676c1">uart_datalink_tx_housekeep</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>UART layer 2 transmit housekeeping. </p>
<p>UART layer 2 transmit housekeeping routine that performs actions needed on a reoccuring basis to enable the layer 2 protocol functionality. Actions such a checking for new data waiting to be transmitted are performed.</p>
<p>The transmit UART houskeeping retrieves a waiting byte to be transmitted over UART into a global structure and intializes control flags used for transmission. The <a class="el" href="_faraday___h_a_l_8c.html#afd8af7f055c15f75feddf75285d664ec" title="Enable the UART UCA0IFG transmitter &quot;UCTXIFG&quot; flag.">hal_uart_set_uctxifg()</a> function sets the UART controller transmit interrupt flag to 1 and begins the interrupt base UART transmissions. After each byte the interrupts will cause the next byte to be retrieved until the buffer is empty. An analogy can be made to "kicking" a wheel that keeps rolling until the bottom of the hill.</p>
<p>If data is continuously loaded into the buffer the transmissions will continously occure until new data is no longer placed into the buffer and the buffer empties. </p>

</div>
</div>
<a class="anchor" id="a4840060f1b1b517dd7ca2dfd9fdb2446"></a><!-- doxytag: member="UART_L2.c::uart_tx_datalink_isr" ref="a4840060f1b1b517dd7ca2dfd9fdb2446" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="_u_a_r_t___l2_8h.html#a4840060f1b1b517dd7ca2dfd9fdb2446">uart_tx_datalink_isr</a> </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>UART layer 2 transmit interrupt service routine. </p>
<p>This function contains all the needed actions that are to be performed when a UART transmit interrupt occures. Transmit interrupts occur when a prior byte has completed transmission and the device is ready for the next byte if available. The ISR routine checks if another byte is waiting for be transmitted and transmits it if so, otherwise the ISR stops the transmit "wheel" from turning and enters an inactive state. </p>

</div>
</div>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_u_a_r_t___l2_8c.html">UART_L2.c</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
